<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	  <script src="/static/jquery.js"></script>
    <script src="/static/jquery-ui.js"></script>
	  <script src="/static/jquery.cookie.js"></script>
    <script src="/static/jquery.ui.touch-punch.min.js"></script>
    <script src="/static/worship.js"></script>
    <link href="/static/jquery-ui.css" rel="stylesheet">
<style>
	body {
		margin: 0;
		padding: 0;
	}

	body > :not(#loading):not(#dialog):not(header) {
		margin: 16px;
	}

	:root {
		--primary-color: #1abc9c;
		--secondary-color: #c85550;
		--thirdary-color: #826fee;
		--text-light: #ffffff;
		--header-height: 60px;
	}
	
	#header {
	  background: var(--primary-color);
	  color: var(--text-light);
	  display: flex;
	  align-items: center;
	  justify-content: space-between;	
	  padding: 0 20px;
	  margin: 0;
	  height: var(--header-height);
	  width: 100%;
	  box-sizing: border-box;
	  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
	  position: sticky;
	  top: 0;
	  z-index: 100;								
	}

	/* Navigation Styles */
	.navigation a {
		color: var(--text-light);
		text-decoration: none;
		text-align: center;
	  	padding: 14px 16px;
	  	border-radius: 10px;
	  	transition: color 0.3s ease, background-color 0.3s ease;
	}

	.navigation a:hover {
        text-decoration: underline;
		background-color: #ddd;
  		color: black;
    }

	.navigation a.active {
		background-color: var(--thirdary-color);
  		color: white;
	}

	/* Profile Bubble Styles */
	.profile_bubble {
	    height: 35px;
		width: 35px;
		border-radius: 50%;
		color: var(--text-light);
		display: flex;
		align-items: center;
		justify-content: center;
		font-weight: bold;
		font-size: 14px;
		overflow: hidden;
		cursor: pointer;
		box-shadow: 0 2px 4px rgba(0,0,0,0.2);
		text-decoration: none; 
	}

	 /* Only apply the orange background when initials are used */
    .profile_bubble.use-initials {
        background-color: var(--secondary-color);
    }

	.profile_bubble img{
		width: 100%;
		height: 100%;
		object-fit: cover;
	}
	
	/*Idk what this is*/
	#loading {
	    display: none;
	    z-index:999;
	    background-color: #000;
	    position: fixed;
		/*
		opacity: 0.8;
	    overflow: show;
	    margin: auto;
		*/
	    top: 0;
	    left: 0;
	    bottom: 0;
	    right: 0;
	}
	

	/* Mobile Adjustments */
	@media (max-width: 600px) {
		#header {
			padding: 0 10px;
		}
	}
	
</style>
</head>

	<div id="loading"></div>
	<div id="dialog"></div>

	<header id="header">
		<div id="profile">
			<a href="/profile" id="profile-container" class="profile_bubble">
				<!-- Image injected by JS below to prevent flickering -->
			</a>
		</div>
		<nav class="navigation">
			<a href="/">Home</a>
			<a href="/song/list">Songs</a>
			<a href="/calendar">Calendar</a>
			<a href="/slides">Slides</a>
		</nav>
	</header>

<script>

	// - Active Tab Logic
	const currentPath = window.location.pathname;
    
	$('.navigation a').each(function() {
        const linkPath = $(this).attr('href');
        
        // If the current URL matches the link's href, make it active.
        // We ensure that the home link ("/") requires an exact match, 
        // while others can be partial matches (e.g., matching "/calendar" even if you're on "/calendar/events")
        if (currentPath === linkPath || (linkPath !== '/' && currentPath.startsWith(linkPath))) {
            $(this).addClass('active');
        }
    });

	//Profile Picture Logic
    const userCookie = $.cookie("user_name");
	const profileContainer = $('#profile-container');
    
    if(userCookie) {
        const full_english_name = userCookie.split('(')[0].trim();

		//Split name, grab the first letters, join them together, and uppercase
		const initials = full_english_name.split(' ').map(word => word[0].toUpperCase()).join('');

        const chinese_name = userCookie.split('(')[1]?.replace(')', '');
        const imgPath = `/static/img/${full_english_name}.jpg`;
		console.log(chinese_name);
		console.log(full_english_name);

        const img = new Image();
        img.onload = function () {
            profileContainer.html(`<img src="${imgPath}" alt="${full_english_name}" />`);
        };
	
        img.onerror = function () {
			profileContainer.addClass('use-initials');
			profileContainer.html(initials);
        };
        img.src = imgPath;
    }else{
		profileContainer.html(`<img id="profile-img" src="../static/img/login.jpg" title="Profile"/>`);
	}
</script>
